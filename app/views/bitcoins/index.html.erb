<!-- ========================== -->
<!-- Monitor de PreÃ§o do Bitcoin -->
<!-- ========================== -->

<!-- ğŸ”¹ 1. Container principal com fundo e alinhamento ajustado -->
<!-- ğŸ”¸ ALTERADO: justify-content-center â†’ justify-content-start -->
<!-- ğŸ”¸ ADICIONADO: pt-5 para criar espaÃ§o no topo -->
<div class="min-vh-100 d-flex flex-column justify-content-start align-items-center pt-5" 
     style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: white;">

  <div class="container text-center mt-4">
    <h1 class="mb-4 fw-bold">
      ğŸ’ Monitor de PreÃ§o do <span style="color:#f39c12;">Bitcoin</span>
    </h1>

    <!-- ğŸ”¹ 2. Estrutura principal com card e grÃ¡fico -->
    <div class="row align-items-center justify-content-center">
      
      <!-- ğŸŸ© Card com os valores -->
      <div class="col-md-4 mb-4">
        <div class="card p-4 shadow-lg border-0" 
             style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);">
          <p class="fs-4 text-success fw-bold">ğŸ’µ USD: <span id="usd"><%= @precos[:usd] %></span></p>
          <p class="fs-4 text-warning fw-bold">ğŸ’° BRL: <span id="brl"><%= @precos[:brl] %></span></p>
          <p class="text-light mt-3">â° Atualizado em: 
            <span id="hora"><%= Time.now.strftime("%H:%M:%S") %></span>
          </p>
        </div>
      </div>

      <!-- ğŸŸ¦ GrÃ¡fico -->
      <div class="col-md-6">
        <canvas id="grafico" height="250"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- ====================== -->
<!-- IMPORTAÃ‡Ã•ES DE ESTILO  -->
<!-- ====================== -->

<!-- Bootstrap -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  crossorigin="anonymous">
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  crossorigin="anonymous">
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ======================= -->
<!-- SCRIPT DO GRÃFICO      -->
<!-- ======================= -->
<script>
  const ctx = document.getElementById('grafico');

  const grafico = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'PreÃ§o BTC (USD)',
        data: [],
        borderColor: "#ffa726",
        backgroundColor: "rgba(255,167,38,0.2)",
        borderWidth: 4,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: "#fff",
        pointBorderColor: "#ffa726",
        pointRadius: 4
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: false,
          ticks: { color: "white" },
          grid: { color: "rgba(255,255,255,0.1)" },
          suggestedMin: 50000,
          suggestedMax: 120000
        },
        x: {
          ticks: { color: "white" },
          grid: { color: "rgba(255,255,255,0.1)" }
        }
      },
      plugins: {
        legend: {
          labels: { color: "white" }
        }
      }
    }
  });

  async function atualizar() {
    const resposta = await fetch('/atualizar_preco');
    const dados = await resposta.json();

    document.getElementById('usd').textContent = dados.usd;
    document.getElementById('brl').textContent = dados.brl;
    document.getElementById('hora').textContent = new Date().toLocaleTimeString();

    // âœ… Converte o valor em nÃºmero real, removendo vÃ­rgulas e sÃ­mbolos
    const valorUSD = Number(dados.usd.toString().replace(/[^\d.-]/g, ''));
    grafico.data.labels.push(new Date().toLocaleTimeString());
    grafico.data.datasets[0].data.push(valorUSD);

    if (grafico.data.labels.length > 10) {
      grafico.data.labels.shift();
      grafico.data.datasets[0].data.shift();
    }

    grafico.update();
  }

  // âœ… Executa imediatamente e depois a cada 5s
  atualizar();
  setInterval(atualizar, 5000);
</script>

